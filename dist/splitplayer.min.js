/* splitplayer 1.0.3 - http://www.splitplay.tv - copyright Holger Schauf */
"use strict";var extend=function(a){a=a||{};for(var b=1;b<arguments.length;b++)if(arguments[b])for(var c in arguments[b])arguments[b].hasOwnProperty(c)&&(a[c]=arguments[b][c]);return a},playerState={unstarted:-1,ended:0,playing:1,pause:2,buffering:3,loading:6},SplitPlayer=function(a){this.duration=0,this.readyCount=0,this.$dom=null,this.videos=[],this.plugins=[],this.playerStateIs=playerState.inactive,this.ticker=null,this._dependenciesLoaded=!1,this.settings=extend({hoster:"youtube",videos:[],area:null,maxVideos:6,volume:100,template:'<div id="SplitPlayer"></div>'},a),this._render();var b=!0,c=!1,d=void 0;try{for(var e,f=this.settings.videos[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;this.addVideo(g)}}catch(h){c=!0,d=h}finally{try{!b&&f["return"]&&f["return"]()}finally{if(c)throw d}}return this};SplitPlayer.prototype={addPlugin:function(a,b){var c=new a(this,b||{});return this.plugins.push(c),c},_onVideoDependeciesReady:function(){this.playerStateIs=playerState.loading;var a=!0,b=!1,c=void 0;try{for(var d,e=this.videos[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.ready()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}this._dependenciesLoaded=!0,console.info("api loaded")},addVideos:function(a){var b=!0,c=!1,d=void 0;try{for(var e,f=a[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;this.addVideo(g)}}catch(h){c=!0,d=h}finally{try{!b&&f["return"]&&f["return"]()}finally{if(c)throw d}}if(this._dependenciesLoaded){var i=!0,j=!1,k=void 0;try{for(var l,m=this.videos[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var g=l.value;g.ready()}}catch(h){j=!0,k=h}finally{try{!i&&m["return"]&&m["return"]()}finally{if(j)throw k}}}return this},addVideo:function(a){if(this.videos.length>=this.settings.maxVideos)return console.error("video limit reached only %s allowed",this.settings.maxVideos);if(!SplitPlayerVideo.hasOwnProperty(a.hoster))return console.error("video hoster %s not available",a.hoster);var b=new SplitPlayerVideo[a.hoster](this,a);return b.load(this._onVideoDependeciesReady.bind(this)),this.videos.push(b),this},getVideo:function(a){return _.find(this.videos,function(b){return b.settings.videoId===a})},destroy:function(){var a=!0,b=!1,c=void 0;try{for(var d,e=this.videos[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;this.destroyVideo(f.settings.videoId)}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}var h=!0,i=!1,j=void 0;try{for(var k,l=this.plugins[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value;m.destroy&&m.destroy()}}catch(g){i=!0,j=g}finally{try{!h&&l["return"]&&l["return"]()}finally{if(i)throw j}}},destroyVideo:function(a){var b=this.removeVideo(a);b.destroy()},emptyPlayer:function(){var a=!0,b=!1,c=void 0;try{for(var d,e=this.videos[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;this.destroyVideo(f.settings.videoId)}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}},removeVideo:function(a){var b=this.getVideo(a);if(!b)return!1;this.videos=_.without(this.videos,b);var c=!0,d=!1,e=void 0;try{for(var f,g=this.videos[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;h.setPlayerDuration()}}catch(i){d=!0,e=i}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}return this.readyCount--,b},onReady:function(){if(this.readyCount++,this.readyCount!==this.videos.length)return console.info("videos not ready yet");this.play(),this.pause(),this.playerStateIs=playerState.ready;var a=!0,b=!1,c=void 0;try{for(var d,e=this.plugins[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.onReady&&f.onReady()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}},onUpdate:function(){var a=!0,b=!1,c=void 0;try{for(var d,e=this.plugins[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.onUpdate&&f.onUpdate()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}},changeState:function(a){return a===playerState.buffering?this.pause():a===playerState.pause?this.pause():a===playerState.playing?this.play():void 0},play:function(){this.ticker=window.setInterval(this.onUpdate.bind(this),500);var a=!0,b=!1,c=void 0;try{for(var d,e=this.videos[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.play()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}var h=!0,i=!1,j=void 0;try{for(var k,l=this.plugins[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value;m.onPlay&&m.onPlay()}}catch(g){i=!0,j=g}finally{try{!h&&l["return"]&&l["return"]()}finally{if(i)throw j}}return this.playerStateIs=playerState.playing,console.info("playing"),this},pause:function(){if(clearInterval(this.ticker),this.playerStateIs===playerState.pause)return console.info("allready pausing");var a=!0,b=!1,c=void 0;try{for(var d,e=this.videos[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.pause()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}var h=!0,i=!1,j=void 0;try{for(var k,l=this.plugins[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value;m.onPause&&m.onPause()}}catch(g){i=!0,j=g}finally{try{!h&&l["return"]&&l["return"]()}finally{if(i)throw j}}return this.playerStateIs=playerState.pause,console.info("pause"),this},toggle:function(){return this.playerStateIs===playerState.pause?this.play():this.pause()},stop:function(){if(clearInterval(this.ticker),this.playerStateIs===playerState.pause||this.playerStateIs===playerState.playing){var a=!0,b=!1,c=void 0;try{for(var d,e=this.videos[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.stop()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}var h=!0,i=!1,j=void 0;try{for(var k,l=this.plugins[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value;m.onStop&&m.onStop()}}catch(g){i=!0,j=g}finally{try{!h&&l["return"]&&l["return"]()}finally{if(i)throw j}}return this.playerStateIs=playerState.unstarted,console.info("stopped"),this}},timeTo:function(a){var b=!0,c=!1,d=void 0;try{for(var e,f=this.videos[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;g.timeTo(a)}}catch(h){c=!0,d=h}finally{try{!b&&f["return"]&&f["return"]()}finally{if(c)throw d}}return this},volumeTo:function(a){a>100?a=100:0>a&&(a=0),this.settings.volume=a;var b=!0,c=!1,d=void 0;try{for(var e,f=this.videos[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;g.volumeTo(a)}}catch(h){c=!0,d=h}finally{try{!b&&f["return"]&&f["return"]()}finally{if(c)throw d}}return this},getPlayedTime:function(){return 0},_videosInState:function(a){var b=!0,c=!0,d=!1,e=void 0;try{for(var f,g=this.videos[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;h.getPlayerState()===a&&b&&(b=!1)}}catch(i){d=!0,e=i}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}return b},_render:function(){return null===this.settings.area?console.info("no html parent defined",this.settings.area):void(this.$dom=$(this.settings.area).prepend(this.settings.template))}};var SplitPlayerSoundManager=function(a,b){this.player=a,this.$volume=null,this.settings=$.extend({},this.player.settings,{area:null,template:'<i class="preview-line"><time></time></i>'},b||{})};SplitPlayerSoundManager.prototype={_setEvents:function(){this.$volume.on("change",this._setSound.bind(this))},_showTime:function(a){var b=a.pageX-this.timeline.offset().left,c=100*b/this.timeline.width();0>c&&(c=0),this.previewedTime=this.timeManager.player.duration/100*c,this.previewLine.width(c+"%").find("time").html(this.timeManager._formatTime(this.previewedTime))},_setTime:function(){this.timeManager.player.stop(),this.timeManager.player.timeTo(this.previewedTime),setTimeout(this.timeManager.player.play.bind(this.timeManager.player),100)},_render:function(){return null===this.settings.area?console.error("no dropArea for timeDisplay defined"):(this.settings.area.append(this.settings.template),void(this.previewLine=this.timeline.find(".preview-line")))}};var SplitPlayerTimeDisplay=function(a,b){return this.timeManager=a,this.$display=null,this.$duration=null,this.$current=null,this.settings=extend({},this.timeManager.settings,{area:null,template:'<i class="time-display"><time class="current">&nbsp;</time><time class="duration">&nbsp;</time></i>'},b),this._render(),this};SplitPlayerTimeDisplay.prototype={onReady:function(){this.onSetTo(this.timeManager.getData())},onSetTo:function(a){this.$duration.html(a.durationFormatted),this.$current.html(a.playedTimeFormatted)},_render:function(){return null===this.settings.area?console.error("no dropArea for timeDisplay defined"):(this.$display=$(this.settings.area),this.$display.append(this.settings.template),this.$duration=this.$display.find(".duration"),void(this.$current=this.$display.find(".current")))},destroy:function(){this.$display.remove()}};var SplitPlayerTimeLine=function(a,b){return this.timeManager=a,this.timeManager.timeline=null,this.$bar=null,this.settings=extend({},this.timeManager.settings,{template:'<div id="timeline"><i class="bar"></i></div>'},b),this._render(),this};SplitPlayerTimeLine.prototype={onReady:function(){this.isActive=!0},onStop:function(){this._reset()},onSetTo:function(a){this.$bar.css({width:a.percentage+"%"})},_reset:function(){this.$bar.css({width:0})},_render:function(){var a=$(this.settings.area).append(this.settings.template);this.timeManager.$timeline=a.find("#timeline"),this.$bar=this.timeManager.$timeline.find("i")},destroy:function(){this.timeManager.$timeline.remove()}};var SplitPlayerTimeManager=function(a,b){return this.player=a,this.isActive=!1,this.playedTime=0,this.plugins=[],this.settings=$.extend({},this.player.settings,{},b||{}),this};SplitPlayerTimeManager.prototype={extend:function(a,b){return a=new a(this,b||{}),this.plugins.push(a),this.player.plugins.push(a)},onReady:function(){this.isActive=!0},onUpdate:function(){this.setTo(this.player.getPlayedTime())},onStop:function(){this.playedTime=0},setTo:function(a){this.playedTime=a;var b=!0,c=!1,d=void 0;try{for(var e,f=this.plugins[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;g.onSetTo&&g.onSetTo(this.getData())}}catch(h){c=!0,d=h}finally{try{!b&&f["return"]&&f["return"]()}finally{if(c)throw d}}},getData:function(){var a=100*this.playedTime/this.player.duration,b=this.player.duration,c=this._formatTime(this.playedTime),d=this._formatTime(b);return{percentage:a,playedTime:this.playedTime,playedTimeFormatted:c,duration:b,durationFormatted:d}},_formatTime:function(a){var b=Math.floor(a/60),c=Math.round(a-60*b);return 10>c&&(c="0"+c),b+":"+c}};var SplitPlayerTimePicker=function(a,b){return this.timeManager=a,this.$timeline=this.timeManager.$timeline,this.$previewLine=null,this.previewedTime=0,this.settings=extend({},this.timeManager.settings,{area:"#timeline",template:'<i class="preview-line"><time></time></i>'},b||{}),this._render(),this._setEvents(),this};SplitPlayerTimePicker.prototype={_setEvents:function(){this.$timeline.on("mousemove",this._showTime.bind(this)).on("mouseup",this._setTime.bind(this))},_showTime:function(a){var b=a.pageX-this.$timeline.offset().left,c=100*b/this.$timeline.width();0>c&&(c=0),this.previewedTime=this.timeManager.player.duration/100*c,this.$previewLine.width(c+"%").find("time").html(this.timeManager._formatTime(this.previewedTime))},_setTime:function(){this.timeManager.player.stop(),this.timeManager.player.timeTo(this.previewedTime),setTimeout(this.timeManager.player.play.bind(this.timeManager.player),100)},_render:function(){this.$timeline.append(this.settings.template),this.$previewLine=this.$timeline.find(".preview-line")}};var SplitPlayerTimeSync=function(a,b){return this.timeManager=a,this.timeline=this.timeManager.timeline,this.previewedTime=0,this.settings=extend({},this.timeManager.settings,{area:"#timeline",template:'<i class="preview-line"><time></time></i>'},b||{}),this._render(),this._setEvents(),this};SplitPlayerTimeSync.prototype={seconds:{},stepValue:.1,interval:null,setEvents:function(){var a=this;$(".time-set-button-up").off("mousedown").on("mousedown",function(b){b.preventDefault(),a.start("increase",$(this).attr("videoId"))}).off("mouseup").on("mouseup",function(b){b.preventDefault(),a.stop()}).off("mouseleave").on("mouseleave",this.stop.bind(this)),$(".time-set-button-down").off("mousedown").on("mousedown",function(b){b.preventDefault(),a.start("decrease",$(this).attr("videoId"))}).off("mouseup").on("mouseup",function(b){b.preventDefault(),a.stop()}).off("mouseleave").on("mouseleave",this.stop.bind(this)),$(".time-set-input").change(function(){var b=$(this).attr("videoId");a.seconds[b]=parseFloat($(this).val());var c=sp.player.getVideoByVideoId(b);c.player.seekTo(a.seconds[b]),a.setStartSeconds(b,a.seconds[b])})},start:function(a,b){var c=this;c[a](b),this.interval=window.setInterval(function(){c[a](b)},100)},stop:function(){window.clearInterval(this.interval)},increase:function(a){"undefined"==typeof this.seconds[a]?this.seconds[a]=this.stepValue:this.seconds[a]=parseFloat(this.seconds[a])+parseFloat(this.stepValue),this.seconds[a]=this.roundDecimal(this.seconds[a]),this.setStartSeconds(a,this.seconds[a])},decrease:function(a){return 0===this.seconds[a]?!1:("undefined"==typeof this.seconds[a]?this.seconds[a]=0:this.seconds[a]>0&&(this.seconds[a]=parseFloat(this.seconds[a])-parseFloat(this.stepValue)),this.seconds[a]=this.roundDecimal(this.seconds[a]),void this.setStartSeconds(a,this.seconds[a]))},roundDecimal:function(a){return parseFloat(Math.round(100*a)/100)},setStartSeconds:function(a,b){var c=sp.player.getVideoByVideoId(a);c.startSeconds=b,$("#"+a+"Number").val(b),this.sync()},sync:function(){var a=_.sortBy(sp.player.selectedVideos,"startSeconds"),b=parseFloat(parseFloat(parseFloat(a[0].player.getCurrentTime())-parseFloat(a[0].startSeconds)));sp.player.setTime(b),console.log("video time: %s",b)}};var SplitPlayerVideo=SplitPlayerVideo||{};SplitPlayerVideo.youtube=function(a,b){return this.player=a,this.videoPlayer=null,this.settings=extend({videoId:null,startSeconds:0,isMuted:!1},b),this.isMuted=this.settings.isMuted,this},SplitPlayerVideo.youtube.prototype={loadingDependencies:!1,load:function(a){this.loadingDependencies||(this.loadingDependencies=!0,$.getScript("//youtube.com/iframe_api",function(){window.onYouTubeIframeAPIReady=a}))},ready:function(){this._render(),this.create()},create:function(){this.videoPlayer=new YT.Player("replacer"+this.settings.videoId,{width:"100%",height:"100%",videoId:this.settings.videoId,startSeconds:this.settings.startSeconds,playerVars:{controls:1},events:{onReady:this.onReady.bind(this),onStateChange:this.onStateChange.bind(this),onError:this.onError.bind(this)}})},onReady:function(){this.setPlayerDuration(),this.mute(),this.player.onReady()},onError:function(a){var b=a.data;(100===b||150===b)&&console.error("Video %s Not Found",this.settings.videoId),this.noVideo()},onStateChange:function(a){return a.data===YT.PlayerState.BUFFERING?this.player.changeState(playerState.buffering):a.data===YT.PlayerState.PLAYING?this.player.changeState(playerState.playing):a.data===YT.PlayerState.PAUSED?this.player.changeState(playerState.pause):void console.info("state %s not fetched",a.data)},getPlayerState:function(){return this.videoPlayer.getPlayerState()},remove:function(){this.videoPlayer.destroy()},timeTo:function(a){return console.log(this.videoPlayer.getPlayerState()),a>=this.getDuration()?(this.stop(),console.info("time for %s out of range",this.settings.videoId)):(a+=this.settings.startSeconds,void this.videoPlayer.seekTo(a))},volumeTo:function(a){return this.isMuted?!1:(this.videoPlayer.setVolume(a),!0)},mute:function(){return this.isMuted?(this.videoPlayer.mute(),this.isMuted=!0,!0):!1},unMute:function(){return this.isMuted?(this.isMuted=!1,this.volumeTo(this.player.settings.volume),!0):!1},play:function(){this.videoPlayer.playVideo()},pause:function(){this.videoPlayer.pauseVideo()},stop:function(){this.timeTo(0),this.pause()},getDuration:function(){return this.videoPlayer.getDuration()-this.settings.startSeconds},setPlayerDuration:function(){var a=this.getDuration();this.player.duration<a&&(this.player.duration=a,this.player.getPlayedTime=this.getPlayedTime.bind(this))},getPlayedTime:function(){return this.videoPlayer.getCurrentTime()-this.settings.startSeconds},_render:function(){$("#SplitPlayer").append('<div id="'+this.settings.videoId+'"><div id="replacer'+this.settings.videoId+'"><div></div>')},noVideo:function(){this.player.removeVideo(this.settings.videoId),$("#"+this.settings.videoId).html('<div class="no-video"></div>')},destroy:function(){$("#"+this.settings.videoId).remove()}};