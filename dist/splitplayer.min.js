/* SplitPlayer 1.0.0 - http://www.splitplay.tv */
"use strict";var playerState={unstarted:-1,ended:0,playing:1,pause:2,buffering:3,loading:6},SplitPlayer=function(a){return this.duration=0,this.readyCount=0,this.videos=[],this.plugins=[],this.playerStateIs=playerState.inactive,this.ticker=null,this._dependenciesLoaded=!1,this.settings=$.extend({hoster:"youtube",videos:[],area:null,maxVideos:4},a),this._loadVideoDependencies(),this};SplitPlayer.prototype={getPlayedTime:function(){return 0},addPlugin:function(a){var b=new a(this);return this.plugins.push(b),b},_loadVideoDependencies:function(){this._dependenciesLoaded||SplitPlayerVideo[this.settings.hoster].load(this._onVideoDependeciesReady.bind(this))},_onVideoDependeciesReady:function(){this._dependenciesLoaded=!0,this._render();var a=!0,b=!1,c=void 0;try{for(var d,e=this.settings.videos[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;this.addVideo(f)}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}this.playerStateIs=playerState.loading,console.info("api loaded")},addVideo:function(a){return this.videos.length>=this.settings.maxVideos?console.info("video limit reached only %s allowed",this.settings.maxVideos):void this.videos.push(new SplitPlayerVideo[this.settings.hoster](this,{video:a}))},removeVideo:function(a){var b=_.find(this.videos,function(b){return b.settings.video.videoId===a});if(!b)return!1;b.destroy(),this.videos=_.without(this.videos,b);var c=!0,d=!1,e=void 0;try{for(var f,g=this.videos[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;h.setPlayerDuration()}}catch(i){d=!0,e=i}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}this.readyCount--},onReady:function(){if(this.readyCount++,this.readyCount!==this.videos.length)return console.info("videos not ready yet");this.playerStateIs=playerState.ready;var a=!0,b=!1,c=void 0;try{for(var d,e=this.plugins[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.onReady&&f.onReady()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}},onUpdate:function(){var a=!0,b=!1,c=void 0;try{for(var d,e=this.plugins[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.onUpdate&&f.onUpdate()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}},changeState:function(a){return this.isFreezed?!1:(console.info("state changed to %s",a),this.readyCount!==this.videos.length?!1:a===playerState.buffering?this.pause():a===playerState.pause?this.pause():a===playerState.playing?this.play():void 0)},play:function(){this.ticker=window.setInterval(this.onUpdate.bind(this),500);var a=!0,b=!1,c=void 0;try{for(var d,e=this.videos[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.play()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}var h=!0,i=!1,j=void 0;try{for(var k,l=this.plugins[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value;m.onPlay&&m.onPlay()}}catch(g){i=!0,j=g}finally{try{!h&&l["return"]&&l["return"]()}finally{if(i)throw j}}return this.playerStateIs=playerState.playing,console.info("playing")},pause:function(){if(this.readyCount!==this.videos.length)return console.info("pause not ready yet");if(this.playerStateIs===playerState.pause)return console.info("allready pausing");var a=!0,b=!1,c=void 0;try{for(var d,e=this.videos[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.pause()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}clearInterval(this.ticker);var h=!0,i=!1,j=void 0;try{for(var k,l=this.plugins[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value;m.onPause&&m.onPause()}}catch(g){i=!0,j=g}finally{try{!h&&l["return"]&&l["return"]()}finally{if(i)throw j}}return this.playerStateIs=playerState.pause,console.info("pause")},toggle:function(){return this.playerStateIs===playerState.pause?this.play():this.pause()},stop:function(){if(this.readyCount!==this.videos.length)return console.info("stop not ready yet");if(this.playerStateIs!==playerState.unstarted){var a=!0,b=!1,c=void 0;try{for(var d,e=this.videos[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.stop()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}clearInterval(this.ticker);var h=!0,i=!1,j=void 0;try{for(var k,l=this.plugins[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value;m.onStop&&m.onStop()}}catch(g){i=!0,j=g}finally{try{!h&&l["return"]&&l["return"]()}finally{if(i)throw j}}return this.playerStateIs=playerState.unstarted,console.info("stopped")}},timeTo:function(a){var b=!0,c=!1,d=void 0;try{for(var e,f=this.videos[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;g.timeTo(a)}}catch(h){c=!0,d=h}finally{try{!b&&f["return"]&&f["return"]()}finally{if(c)throw d}}},volumeTo:function(a){var b=!0,c=!1,d=void 0;try{for(var e,f=this.videos[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;g.volumeTo(a)}}catch(h){c=!0,d=h}finally{try{!b&&f["return"]&&f["return"]()}finally{if(c)throw d}}},_videosInState:function(a){var b=!0,c=!0,d=!1,e=void 0;try{for(var f,g=this.videos[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;h.getPlayerState()===a&&b&&(b=!1)}}catch(i){d=!0,e=i}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}return b},_render:function(){return null===this.settings.area?console.info("no html parent defined",this.settings.area):void $(this.settings.area).html('<div id="SplitPlayer"></div>')}};var SplitPlayerTimePicker=function(a){return this.timeline=a,this.template='<i class="preview-line"><time></time></i>',this.previewedTime=0,this};SplitPlayerTimePicker.prototype={onReady:function(){this.render(),this._setEvents()},_setEvents:function(){this.timeline.element.on("mousemove",this._showTime.bind(this)).on("mouseup",this._setTime.bind(this))},_showTime:function(a){var b=a.pageX-this.timeline.element.offset().left,c=100*b/this.timeline.element.width();this.previewedTime=this.timeline.player.duration/100*c,this.previewLine.width(c+"%").find("time").html(this._formatTime(this.previewedTime))},_setTime:function(){this.timeline.player.pause(),this.timeline.player.timeTo(this.previewedTime),this.timeline.setTo(this.previewedTime),this.timeline.player.play()},_formatTime:function(a){var b=Math.floor(a/60),c=Math.round(a-60*b);return 10>c&&(c="0"+c),b+":"+c},render:function(){this.timeline.element.append(this.template),this.previewLine=this.timeline.element.find(".preview-line")}};var SplitPlayerTimeline=function(a){return this.player=a,this.element=null,this.bar=null,this.template='<div id="timeline"><i class="bar"></i></div>',this};SplitPlayerTimeline.prototype={extend:function(a){return this.player.plugins.push(new a(this))},onReady:function(){this._render()},onUpdate:function(){this.setTo(this.player.getPlayedTime())},onStop:function(){this._reset()},setTo:function(a){var b=100*a/this.player.duration;this.bar.css({width:b+"%"})},_reset:function(){this.bar.css({width:0})},_formatTime:function(a){var b=Math.floor(a/60),c=Math.round(a-60*b);return 10>c&&(c="0"+c),b+":"+c},_render:function(){var a=$(this.player.settings.area).append(this.template);this.element=a.find("#timeline"),this.bar=this.element.find("i")}};var SplitPlayerVideo=SplitPlayerVideo||{};SplitPlayerVideo.youtube=function(a,b){return this.player=a,this.videoPlayer=null,this.isSilent=!1,this.settings=$.extend({video:null,type:"youtube"},b),this.render(),this.create(),this},SplitPlayerVideo.youtube.load=function(a){$.getScript("//youtube.com/iframe_api",function(){window.onYouTubeIframeAPIReady=a})},SplitPlayerVideo.youtube.prototype={create:function(){this.videoPlayer=new YT.Player(this.settings.video.videoId,{width:"100%",height:"100%",videoId:this.settings.video.videoId,startSeconds:this.settings.video.startSeconds,playerVars:{controls:1},events:{onReady:this.onReady.bind(this),onStateChange:this.onStateChange.bind(this)}})},onReady:function(){this.setPlayerDuration(),this.stop(),this.player.onReady()},onStateChange:function(a){return this.isSilence?void 0:(console.log(a.data),a.data===YT.PlayerState.BUFFERING?this.player.changeState(playerState.buffering):a.data===YT.PlayerState.PLAYING?this.player.changeState(playerState.playing):a.data===YT.PlayerState.ENDED?(this.timeTo(0),this.player.changeState(a.data)):a.data===YT.PlayerState.PAUSED?this.player.changeState(playerState.pause):void console.info("state %s not fetched",a.data))},getPlayerState:function(){return this.videoPlayer.getPlayerState()},remove:function(){this.player.removeVideo(this.settings.video),this.videoPlayer.destroy()},timeTo:function(a){return 0===this.getDuration()?(this.isSilent=!0,this.stop(),void(this.isSilent=!1)):a>=this.getDuration()?(this.videoPlayer.seekTo(0),console.info("time for %s out of range",this.settings.video.videoId)):(a+=this.settings.video.startSeconds,console.log("set time to %s",a),void this.videoPlayer.seekTo(a))},setVolume:function(a){return this.isMuted?!1:(this.videoPlayer.setVolume(a),!0)},play:function(){this.videoPlayer.playVideo()},pause:function(){this.videoPlayer.pauseVideo()},stop:function(){this.timeTo(0),this.pause()},getDuration:function(){return this.videoPlayer.getDuration()-this.settings.video.startSeconds},setPlayerDuration:function(){var a=this.getDuration();this.player.duration<a&&(this.player.duration=a,this.player.getPlayedTime=this.getPlayedTime.bind(this))},getPlayedTime:function(){return this.videoPlayer.getCurrentTime()-this.settings.video.startSeconds},render:function(){$("#SplitPlayer").append('<div id="'+this.settings.video.videoId+'"><div>')},destroy:function(){$("#"+this.settings.video.videoId).find("iframe").remove()}};