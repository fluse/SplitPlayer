/* SplitPlayer 1.0.0 - http://www.splitplay.tv */
"use strict";var playerState={unstarted:-1,ended:0,playing:1,pause:2,buffering:3,loading:6},SplitPlayer=function(a){return this.duration=0,this.readyCount=0,this.videos=[],this.plugins=[],this.playerStateIs=playerState.inactive,this.dependenciesLoaded=!1,this.settings=$.extend({hoster:"youtube",videos:[],area:null,maxVideos:4},a),this.loadVideoDependencies(),this};SplitPlayer.prototype={getPlayedTime:function(){return 0},addPlugin:function(a){this.plugins.push(new a(this))},loadVideoDependencies:function(){SplitPlayerVideo[this.settings.hoster].load(this.onVideoDependeciesReady.bind(this))},onVideoDependeciesReady:function(){this.dependenciesLoaded=!0,this.render();var a=!0,b=!1,c=void 0;try{for(var d,e=this.settings.videos[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;this.addVideo(f)}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}this.playerStateIs=playerState.loading,console.info("api loaded")},addVideo:function(a){return this.videos.length>=this.settings.maxVideos?console.info("video limit reached only %s allowed",this.settings.maxVideos):void this.videos.push(new SplitPlayerVideo[this.settings.hoster](this,{video:a}))},removeVideo:function(a){_.findWhere(this.videos,a).remove(),this.videos=_.without(this.videos,_.findWhere(this.videos,a)),this.readyCount--},onReady:function(){if(this.readyCount++,this.readyCount!==this.videos.length)return console.info("videos not ready yet");console.info("player and videos ready"),this.playerStateIs=playerState.ready;var a=!0,b=!1,c=void 0;try{for(var d,e=this.plugins[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.onReady&&f.onReady()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}},changeState:function(a){return console.info("state changed to %s",a),this.readyCount!==this.videos.length?!1:a===playerState.buffering?this.pause():a===playerState.pause?this.pause():a===playerState.playing?this.play():void 0},play:function(){if(this.readyCount!==this.videos.length)return console.info("play not ready yet");if(this.playerStateIs===playerState.playing)return console.info("allready playing");var a=!0,b=!1,c=void 0;try{for(var d,e=this.videos[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.play()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}var h=!0,i=!1,j=void 0;try{for(var k,l=this.plugins[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value;m.onPlay&&m.onPlay()}}catch(g){i=!0,j=g}finally{try{!h&&l["return"]&&l["return"]()}finally{if(i)throw j}}return this.playerStateIs=playerState.playing,console.info("playing")},pause:function(){if(this.readyCount!==this.videos.length)return console.log("pause not ready yet");if(this.playerStateIs===playerState.pause)return console.log("allready pausing");var a=!0,b=!1,c=void 0;try{for(var d,e=this.videos[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.pause()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}var h=!0,i=!1,j=void 0;try{for(var k,l=this.plugins[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value;m.onPause&&m.onPause()}}catch(g){i=!0,j=g}finally{try{!h&&l["return"]&&l["return"]()}finally{if(i)throw j}}return this.playerStateIs=playerState.pause,console.info("pause")},stop:function(){if(this.readyCount!==this.videos.length)return console.log("pause not ready yet");if(this.playerStateIs!==playerState.unstarted){var a=!0,b=!1,c=void 0;try{for(var d,e=this.videos[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;f.stop()}}catch(g){b=!0,c=g}finally{try{!a&&e["return"]&&e["return"]()}finally{if(b)throw c}}var h=!0,i=!1,j=void 0;try{for(var k,l=this.plugins[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value;m.onStop&&m.onStop()}}catch(g){i=!0,j=g}finally{try{!h&&l["return"]&&l["return"]()}finally{if(i)throw j}}return this.playerStateIs=playerState.unstarted,console.info("stopped")}},timeTo:function(a){var b=!0,c=!1,d=void 0;try{for(var e,f=this.videos[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;g.timeTo(a)}}catch(h){c=!0,d=h}finally{try{!b&&f["return"]&&f["return"]()}finally{if(c)throw d}}},render:function(){return null===this.settings.area?console.log("no html parent defined"):void $(this.settings.area).html('<div id="SplitPlayer"></div>')}};var SplitPlayerTimePicker=function(a,b){return this.player=a,this.playedTime=0,this.cycler=0,this.paused=!0,this.timeLine=null,this};SplitPlayerTimePicker.prototype={onReady:function(){},onPlay:function(){return console.log("plugin on play")},onPause:function(){return console.log("plugin on pause")},onStop:function(){return console.log("plugin on stop")},setEvents:function(){var a=this;this.timeLine=$(this.settings.element),this.timeLine.attr("max",this.settings.duration).rangeslider({polyfill:!1}),$(".rangeslider").on("mousedown",function(){a.player.timeTo(a.playedTime)}).on("mousemove",function(b){var c=b.pageX-$(this).offset().left,d=100*c/$(this).width(),e=Math.round(d),f=a.formatTime(a.settings.duration/100*e);a.settings.previewLine.width(d+"%").find("time").html(f)}),$(document).on("input",'input[type="range"]',function(){var b=$(this).val();a.playedTime=b,a.settings.onChange(b)})},run:function(){return this.playedTime>=this.settings.duration||this.paused?this.pause():(this.playedTime++,this.update(),clearTimeout(this.cycler),void(this.cycler=setTimeout(this.run.bind(this),1e3)))},update:function(){this.timeLine.val(this.playedTime).change(),$(this.settings.currentTimeElement).html(this.formatTime(this.playedTime))},formatTime:function(a){var b=Math.floor(a/60),c=Math.round(a-60*b);return 10>c&&(c="0"+c),b+":"+c}};var SplitPlayerTimeline=function(a){return this.player=a,this.cycler=null,this};SplitPlayerTimeline.prototype={onReady:function(){this.render()},onPlay:function(){return this.cycler=window.setInterval(this.getTime.bind(this),50),console.log("plugin on play")},onPause:function(){return clearInterval(this.cycler),console.log("plugin on pause")},onStop:function(){return console.log("plugin on stop")},getTime:function(){console.log(100*this.player.getPlayedTime()/this.player.duration)},render:function(){$(this.player.settings.area).append('<div id="timeline"><i></i></div>')}};var SplitPlayerVideo=SplitPlayerVideo||{};SplitPlayerVideo.youtube=function(a,b){return this.player=a,this.videoPlayer=null,this.settings=$.extend({video:null,type:"youtube"},b),this.render(),this.create(),this},SplitPlayerVideo.youtube.load=function(a){$.getScript("//youtube.com/iframe_api",function(){window.onYouTubeIframeAPIReady=a})},SplitPlayerVideo.youtube.prototype={create:function(){var a=this;this.videoPlayer=new YT.Player(this.settings.video.videoId,{width:"100%",height:"100%",videoId:this.settings.video.videoId,startSeconds:this.settings.video.startSeconds,playerVars:{controls:1},events:{onReady:this.onReady.bind(this),onStateChange:function(b){a.onStateChange(b)}}})},onReady:function(){this.setPlayerDuration(),this.stop(),this.player.onReady()},onStateChange:function(a){return a.data===YT.PlayerState.BUFFERING?this.player.changeState(playerState.buffering):a.data===YT.PlayerState.PLAYING?this.player.changeState(playerState.playing):a.data===YT.PlayerState.ENDED?(this.timeTo(0),this.player.changeState(a.data)):a.data===YT.PlayerState.PAUSED?this.player.changeState(playerState.pause):void console.info("event %s not fetched",a.data)},remove:function(){this.player.removeVideo(this.settings.video),this.videoPlayer.destroy()},timeTo:function(a){a+=this.settings.video.startSeconds,console.log("set time to %s",a),this.videoPlayer.seekTo(a)},play:function(){this.videoPlayer.playVideo()},pause:function(){this.videoPlayer.pauseVideo()},stop:function(){this.timeTo(0),this.pause()},getDuration:function(){return this.videoPlayer.getDuration()-this.settings.video.startSeconds},setPlayerDuration:function(){var a=this.getDuration();this.player.duration<a&&(this.player.duration=a,this.player.getPlayedTime=this.getPlayedTime.bind(this))},getPlayedTime:function(){return this.videoPlayer.getCurrentTime()-this.settings.video.startSeconds},render:function(){$("#SplitPlayer").append('<div id="'+this.settings.video.videoId+'"><div>')},destroy:function(){this.videoPlayer.destory(),this.player.removeVideo(this)}};